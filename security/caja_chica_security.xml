<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">

        <!-- Categoría específica para el módulo de Cajas -->
        <record id="module_category_cash_management" model="ir.module.category">
            <field name="name">Gestión de Cajas</field>
            <field name="description">Gestión de Caja Chica, Distribución y Logística</field>
            <field name="sequence">50</field>
        </record>

        <!-- ========== GRUPOS PRINCIPALES ========== -->

        <!-- Grupo Usuario de Cajas -->
        <record id="group_cash_user" model="res.groups">
            <field name="name">Usuario de Cajas</field>
            <field name="category_id" ref="module_category_cash_management"/>
            <field name="comment">
                Puede crear y gestionar sus propias cajas (Chica, Distribución y Logística).
                Ve solo las cajas de las que es responsable.
            </field>
        </record>

        <!-- Grupo Administrador de Cajas -->
        <record id="group_cash_manager" model="res.groups">
            <field name="name">Administrador de Cajas</field>
            <field name="category_id" ref="module_category_cash_management"/>
            <field name="implied_ids" eval="[(4, ref('group_cash_user'))]"/>
            <field name="comment">
                Acceso completo a todas las cajas. Puede gestionar cajas de todos los usuarios,
                configurar tipos de pago y acceder a todos los reportes.
            </field>
        </record>

        <!-- Reglas de acceso para usuarios normales - Caja Chica -->
        <record id="petty_cash_user_rule" model="ir.rule">
            <field name="name">Caja Chica: Usuario ve solo sus cajas</field>
            <field name="model_id" ref="model_petty_cash"/>
            <field name="groups" eval="[(4, ref('petty_cash.group_cash_user'))]"/>
            <field name="domain_force">[('responsible_id', '=', user.id)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Administradores: Todas las cajas chicas -->
        <record id="petty_cash_manager_rule" model="ir.rule">
            <field name="name">Caja Chica: Administrador ve todas las cajas</field>
            <field name="model_id" ref="model_petty_cash"/>
            <field name="groups" eval="[(4, ref('petty_cash.group_cash_manager'))]"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Líneas de Caja Chica - Usuarios -->
        <record id="petty_cash_line_user_rule" model="ir.rule">
            <field name="name">Líneas Caja Chica: Usuario ve solo líneas de sus cajas</field>
            <field name="model_id" ref="model_petty_cash_line"/>
            <field name="groups" eval="[(4, ref('petty_cash.group_cash_user'))]"/>
            <field name="domain_force">[('petty_cash_id.responsible_id', '=', user.id)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Líneas de Caja Chica - Administradores -->
        <record id="petty_cash_line_manager_rule" model="ir.rule">
            <field name="name">Líneas Caja Chica: Administrador ve todas las líneas</field>
            <field name="model_id" ref="model_petty_cash_line"/>
            <field name="groups" eval="[(4, ref('petty_cash.group_cash_manager'))]"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- ========== REGLAS DE ACCESO PARA CAJA DE DISTRIBUCIÓN ========== -->

        <!-- Usuarios: Solo sus propias cajas de distribución -->
        <record id="distribution_cash_user_rule" model="ir.rule">
            <field name="name">Caja Distribución: Usuario ve solo sus cajas</field>
            <field name="model_id" ref="model_distribution_cash"/>
            <field name="groups" eval="[(4, ref('group_cash_user'))]"/>
            <field name="domain_force">[('responsible_id', '=', user.id)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Administradores: Todas las cajas de distribución -->
        <record id="distribution_cash_manager_rule" model="ir.rule">
            <field name="name">Caja Distribución: Administrador ve todas las cajas</field>
            <field name="model_id" ref="model_distribution_cash"/>
            <field name="groups" eval="[(4, ref('group_cash_manager'))]"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Líneas de Caja de Distribución - Usuarios -->
        <record id="distribution_cash_line_user_rule" model="ir.rule">
            <field name="name">Líneas Caja Distribución: Usuario ve solo líneas de sus cajas</field>
            <field name="model_id" ref="model_distribution_cash_line"/>
            <field name="groups" eval="[(4, ref('group_cash_user'))]"/>
            <field name="domain_force">[('distribution_cash_id.responsible_id', '=', user.id)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Líneas de Caja de Distribución - Administradores -->
        <record id="distribution_cash_line_manager_rule" model="ir.rule">
            <field name="name">Líneas Caja Distribución: Administrador ve todas las líneas</field>
            <field name="model_id" ref="model_distribution_cash_line"/>
            <field name="groups" eval="[(4, ref('group_cash_manager'))]"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- ========== REGLAS DE ACCESO PARA CAJA DE LOGÍSTICA ========== -->

        <!-- Usuarios: Solo sus propias cajas de logística -->
        <record id="logistics_cash_user_rule" model="ir.rule">
            <field name="name">Caja Logística: Usuario ve solo sus cajas</field>
            <field name="model_id" ref="model_logistics_cash"/>
            <field name="groups" eval="[(4, ref('group_cash_user'))]"/>
            <field name="domain_force">[('responsible_id', '=', user.id)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Administradores: Todas las cajas de logística -->
        <record id="logistics_cash_manager_rule" model="ir.rule">
            <field name="name">Caja Logística: Administrador ve todas las cajas</field>
            <field name="model_id" ref="model_logistics_cash"/>
            <field name="groups" eval="[(4, ref('group_cash_manager'))]"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Líneas de Caja de Logística - Usuarios -->
        <record id="logistics_cash_line_user_rule" model="ir.rule">
            <field name="name">Líneas Caja Logística: Usuario ve solo líneas de sus cajas</field>
            <field name="model_id" ref="model_logistics_cash_line"/>
            <field name="groups" eval="[(4, ref('group_cash_user'))]"/>
            <field name="domain_force">[('logistics_cash_id.responsible_id', '=', user.id)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Líneas de Caja de Logística - Administradores -->
        <record id="logistics_cash_line_manager_rule" model="ir.rule">
            <field name="name">Líneas Caja Logística: Administrador ve todas las líneas</field>
            <field name="model_id" ref="model_logistics_cash_line"/>
            <field name="groups" eval="[(4, ref('group_cash_manager'))]"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- ========== REGLAS PARA TIPOS DE PAGO ========== -->

        <!-- Usuarios: Lectura y escritura de tipos de pago -->
        <record id="payment_type_user_rule" model="ir.rule">
            <field name="name">Tipos de Pago: Acceso para usuarios</field>
            <field name="model_id" ref="model_payment_type"/>
            <field name="groups" eval="[(4, ref('group_cash_user'))]"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Administradores: Acceso completo a tipos de pago -->
        <record id="payment_type_manager_rule" model="ir.rule">
            <field name="name">Tipos de Pago: Acceso completo para administradores</field>
            <field name="model_id" ref="model_payment_type"/>
            <field name="groups" eval="[(4, ref('group_cash_manager'))]"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

    </data>
</odoo>